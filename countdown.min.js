(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):b.countDown=a()})(this,function(){function g(h){this._queue=[];this.stop=false;this._createTimer(h)}g.prototype={constructor:g,_createTimer:function(i){var h=this;var j=true;(function(){var l=new Date();for(var k=0;k<h._queue.length;k++){h._queue[k]()}if(!h.stop){var m=new Date()-l;i=j?i:((m>i)?m-i:i);setTimeout(arguments.callee,i)}})();j=false},add:function(h){this._queue.push(h);this.stop=false;return this._queue.length-1},remove:function(h){this._queue.splice(h,1);if(!this._queue.length){this.stop=true}}};function e(){this._pool={}}e.prototype={constructor:e,getTimer:function(i){var h=this._pool[i];return h?h:(this._pool[i]=new g(i))},removeTimer:function(h){if(this._pool[h]){delete this._pool[h]}}};var f=1000;var b=new e().getTimer(f);function a(j){var h={unit:{day:true,hour:true,minute:true,second:true},fixNow:3*1000,fixNowDate:false,now:new Date().valueOf(),render:function(i){console.log(i)},end:function(){console.log("the end!")},endTime:new Date().valueOf()+5*1000*60};for(var k in h){if(h.hasOwnProperty(k)){this[k]=j[k]||h[k]}}this.init()}a.prototype={constructor:a,init:function(){var i=this;if(this.fixNowDate){var h=new g(this.fixNow);h.add(function(){i.getNowTime(function(k){i.now=k})})}var j=b.add(function(){i.now+=f;if(i.now>=i.endTime){b.remove(j);i.end()}else{i.render(i.getOutString())}})},getOutString:function(){return d(this.endTime,this.now,this.unit)},getNowTime:function(h){var i=new XMLHttpRequest();i.open("get","/",true);i.onreadystatechange=function(){if(i.readyState===3){var j=i.getResponseHeader("Date");h(new Date(j).valueOf())}};i.send(null)}};function c(h){var i=parseInt(h,10);return i<10?"0"+i:i}function d(l,k,j){var i={};var h={day:24*60*60*1000,hour:60*60*1000,minute:60*1000,second:1000};var m=0;if(j.day){i.day=c(Math.floor((l-k-m)/h.day));m+=i.day*h.day}if(j.hour){i.hour=c(Math.floor((l-k-m)/h.hour));m+=i.hour*h.hour}if(j.minute){i.minute=c(Math.floor((l-k-m)/h.minute));m+=i.minute*h.minute}if(j.second){i.second=c(Math.floor((l-k-m)/h.second));m+=i.second*h.second}return i}return a});