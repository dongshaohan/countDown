(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?module.exports=b():typeof define==="function"&&define.amd?define(b):a.countDown=b()})(this,function(){function e(f){this._queue=[];this.stop=false;this._createTimer(f)}e.prototype={constructor:e,_createTimer:function(g){var f=this;var h=true;(function(){var k=new Date();for(var j=0;j<f._queue.length;j++){f._queue[j]()}if(!f.stop){var l=new Date()-k;g=h?g:((l>g)?l-g:g);setTimeout(arguments.callee,g)}})();h=false},add:function(f){this._queue.push(f);this.stop=false;return this._queue.length-1},remove:function(f){this._queue.splice(f,1);if(!this._queue.length){this.stop=true}}};function a(){this._pool={}}a.prototype={constructor:a,getTimer:function(g){var f=this._pool[g];return f?f:(this._pool[g]=new e(g))},removeTimer:function(f){if(this._pool[f]){delete this._pool[f]}}};function b(h){var f={unit:{day:true,hour:true,minute:true,second:true},fixNow:3*1000,fixNowDate:false,delayTime:1000,now:new Date().valueOf(),render:function(i){console.log(i)},end:function(){console.log("the end!")},endTime:new Date().valueOf()+5*1000*60};for(var g in f){if(f.hasOwnProperty(g)){this[g]=h[g]||f[g]}}this.index=null;this.msInterval=new a().getTimer(this.delayTime);this.init()}b.prototype={constructor:b,init:function(){var g=this;if(this.fixNowDate){var f=new e(this.fixNow);f.add(function(){g.getNowTime(function(h){g.now=h})})}this.index=g.msInterval.add(function(){g.now+=g.delayTime;if(g.now>=g.endTime){g.msInterval.remove(g.index);g.end()}else{g.render(g.getOutString())}})},getOutString:function(){return d(this.endTime,this.now,this.unit)},getNowTime:function(f){var g=new XMLHttpRequest();g.open("get","/",true);g.onreadystatechange=function(){if(g.readyState===3){var h=g.getResponseHeader("Date");f(new Date(h).valueOf())}};g.send(null)},destroy:function(){this.msInterval.remove(this.index)}};function c(f){var g=parseInt(f,10);return g<10?"0"+g:g}function d(j,i,h){var g={};var f={day:24*60*60*1000,hour:60*60*1000,minute:60*1000,second:1000};var k=0;if(h.day){g.day=c(Math.floor((j-i-k)/f.day));k+=g.day*f.day}if(h.hour){g.hour=c(Math.floor((j-i-k)/f.hour));k+=g.hour*f.hour}if(h.minute){g.minute=c(Math.floor((j-i-k)/f.minute));k+=g.minute*f.minute}if(h.second){g.second=c(Math.floor((j-i-k)/f.second));k+=g.second*f.second}return g}return b});