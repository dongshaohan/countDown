(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?module.exports=b():typeof define==="function"&&define.amd?define(b):a.countDown=b()})(this,function(){function g(h){this._queue=[];this.stop=false;this._createTimer(h)}g.prototype={constructor:g,_createTimer:function(i){var h=this;var j=true;(function(){var l=new Date();for(var k=0;k<h._queue.length;k++){h._queue[k]()}if(!h.stop){var m=new Date()-l;i=j?i:((m>i)?m-i:i);setTimeout(arguments.callee,i)}})();j=false},add:function(h){this._queue.push(h);this.stop=false;return this._queue.length-1},remove:function(h){this._queue.splice(h,1);if(!this._queue.length){this.stop=true}}};function a(){this._pool={}}a.prototype={constructor:a,getTimer:function(i){var h=this._pool[i];return h?h:(this._pool[i]=new g(i))},removeTimer:function(h){if(this._pool[h]){delete this._pool[h]}}};var f=1000;var d=new a().getTimer(f);function b(k){var h={unit:{day:true,hour:true,minute:true,second:true},fixServer:3*1000,fixServerDate:false,fixNox:20*1000,fixNowDate:false,now:new Date().valueOf(),clientTime:new Date().getTime(),render:function(i){console.log(i)},end:function(){console.log("the end!")},endTime:new Date().valueOf()+5*1000*60};for(var j in h){if(h.hasOwnProperty(j)){this[j]=k[j]||h[j]}}this.init()}b.prototype={constructor:b,init:function(){var i=this;if(this.fixServerDate){var h=new g(this.fixServer);h.add(function(){i.getServerTime(function(k){i.now=k})})}else{if(this.fixNowDate){var h=new g(this.fixNox);h.add(function(){i.now=i.getNowTime()})}}var j=d.add(function(){i.now+=f;if(i.now>=i.endTime){d.remove(j);i.end()}else{i.render(i.getOutString())}})},getOutString:function(){return e(this.endTime,this.now,this.unit)},getServerTime:function(h){var i=new XMLHttpRequest();i.open("get","/",true);i.onreadystatechange=function(){if(i.readyState===3){var j=i.getResponseHeader("Date");h(new Date(j).valueOf())}};i.send(null)},getNowTimer:function(){return this.now+(new Date().getTime()-this.clientTime)}};function c(h){var i=parseInt(h,10);return i<10?"0"+i:i}function e(l,k,j){var i={};var h={day:24*60*60*1000,hour:60*60*1000,minute:60*1000,second:1000};var m=0;if(j.day){i.day=c(Math.floor((l-k-m)/h.day));m+=i.day*h.day}if(j.hour){i.hour=c(Math.floor((l-k-m)/h.hour));m+=i.hour*h.hour}if(j.minute){i.minute=c(Math.floor((l-k-m)/h.minute));m+=i.minute*h.minute}if(j.second){i.second=c(Math.floor((l-k-m)/h.second));m+=i.second*h.second}return i}return b});